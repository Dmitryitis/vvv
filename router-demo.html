<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã - SPA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-2">
                        <div class="text-2xl font-bold text-blue-600">üè†</div>
                        <span class="text-xl font-semibold text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä</span>
                    </div>
                    
                    <div class="hidden md:flex space-x-6">
                        <router-link to="/" class="nav-link" active-class="nav-link-active">
                            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                        </router-link>
                        <router-link to="/about" class="nav-link" active-class="nav-link-active">
                            –û –ø—Ä–æ–µ–∫—Ç–µ
                        </router-link>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <router-view></router-view>
        </main>
    </div>

    <style>
        .nav-link {
            @apply px-3 py-2 text-gray-600 hover:text-blue-600 transition-colors duration-200 font-medium;
        }
        .nav-link-active {
            @apply text-blue-600 border-b-2 border-blue-600;
        }
        .container {
            max-width: 1200px;
        }
    </style>

    <script>
        const { createApp, ref, computed, onMounted, nextTick, provide, inject } = Vue;
        const { createRouter, createWebHashHistory } = VueRouter;

        // Calculator component with integrated history
        const Calculator = {
            template: `
                <div class="flex gap-8">
                    <!-- Main Calculator Section -->
                    <div class="flex-1 space-y-8">
                        <!-- Hero Section -->
                        <div class="relative bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl overflow-hidden">
                            <div class="flex flex-col lg:flex-row items-center">
                                <div class="lg:w-1/2 p-8">
                                    <h1 class="text-4xl font-bold text-gray-900 mb-4">–£–∑–Ω–∞–π—Ç–µ —Ä—ã–Ω–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã</h1>
                                    <p class="text-gray-700 text-lg mb-6">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-600">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                            –¢–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
                                        </div>
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                            –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç
                                        </div>
                                    </div>
                                </div>
                                <div class="lg:w-1/2">
                                    <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80" 
                                         alt="–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞" 
                                         class="w-full h-64 lg:h-80 object-cover">
                                </div>
                            </div>
                        </div>

                        <!-- Calculation Result -->
                        <div v-if="lastResult" class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ü–µ–Ω–∫–∏</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center p-4 bg-blue-50 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">–†—ã–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</p>
                                    <p class="text-2xl font-bold text-blue-600">{{ formatPrice(lastResult.price) }}</p>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</p>
                                    <p class="text-xl font-semibold text-green-600">{{ formatPrice(lastResult.priceRange?.min) }}</p>
                                </div>
                                <div class="text-center p-4 bg-orange-50 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</p>
                                    <p class="text-xl font-semibold text-orange-600">{{ formatPrice(lastResult.priceRange?.max) }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Calculator Form -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold mb-6">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã</h2>
                            <div class="space-y-6">
                                <!-- Basic Info -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å (–º¬≤)</label>
                                        <input v-model.number="formData.totalArea" type="number" class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å (–º¬≤)</label>
                                        <input v-model.number="formData.livingArea" type="number" class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">–≠—Ç–∞–∂</label>
                                        <input v-model.number="formData.floor" type="number" class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                </div>

                                <!-- Additional Parameters -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                                        <input v-model.number="formData.rooms" type="number" class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">–ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏ (–º¬≤)</label>
                                        <input v-model.number="formData.kitchenArea" type="number" class="w-full p-3 border border-gray-300 rounded-lg">
                                    </div>
                                </div>

                                <!-- Building Type -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–¢–∏–ø –¥–æ–º–∞</label>
                                    <div class="flex flex-wrap gap-2">
                                        <button v-for="(type, index) in buildingTypes" :key="index"
                                                @click="formData.buildingType = index + 1"
                                                :class="formData.buildingType === index + 1 ? 'bg-black text-white' : 'bg-white text-black border'"
                                                class="px-4 py-2 rounded-lg border transition-colors">
                                            {{ type }}
                                        </button>
                                    </div>
                                </div>

                                <!-- Calculate Button -->
                                <button @click="calculatePrice" 
                                        :disabled="!canCalculate"
                                        class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors">
                                    {{ isCalculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å' }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- History Sidebar -->
                    <div class="w-80">
                        <div class="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                            <h3 class="text-xl font-semibold mb-4">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤</h3>
                            <div v-if="calculations.length === 0" class="text-center py-8 text-gray-500">
                                <p>–ü–æ–∫–∞ –Ω–µ—Ç —Ä–∞—Å—á–µ—Ç–æ–≤</p>
                            </div>
                            <div v-else class="space-y-4 max-h-96 overflow-y-auto">
                                <div v-for="calc in calculations.slice(0, 5)" :key="calc.id" 
                                     class="border rounded-lg p-3 hover:bg-gray-50 cursor-pointer"
                                     @click="loadCalculation(calc)">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-lg font-semibold text-blue-600">{{ formatPrice(calc.price) }}</span>
                                        <span class="text-xs text-gray-500">{{ formatDate(calc.timestamp) }}</span>
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        {{ calc.apartmentData.totalArea }}–º¬≤ ‚Ä¢ {{ calc.apartmentData.rooms || 'N' }} –∫–æ–º–Ω
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const lastResult = ref(null);
                const isCalculating = ref(false);
                const calculations = ref([]);
                const buildingTypes = ['–ü–∞–Ω–µ–ª—å–Ω—ã–π', '–ö–∏—Ä–ø–∏—á–Ω—ã–π', '–ú–æ–Ω–æ–ª–∏—Ç–Ω–æ-–∫–∏—Ä–ø–∏—á–Ω—ã–π', '–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π', '–°—Ç–∞–ª–∏–Ω—Å–∫–∏–π'];
                
                const formData = ref({
                    totalArea: null,
                    livingArea: null,
                    floor: null,
                    rooms: null,
                    kitchenArea: null,
                    buildingType: null
                });

                const canCalculate = computed(() => {
                    return formData.value.totalArea && formData.value.livingArea && formData.value.floor;
                });

                onMounted(() => {
                    const stored = localStorage.getItem('apartmentCalculations');
                    if (stored) {
                        calculations.value = JSON.parse(stored);
                    }
                });

                const calculatePrice = async () => {
                    if (!canCalculate.value) return;
                    
                    isCalculating.value = true;
                    
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const price = calculateApartmentPrice(formData.value);
                    const result = {
                        id: Date.now().toString(),
                        timestamp: new Date(),
                        apartmentData: { ...formData.value },
                        price: price.price,
                        priceRange: price.priceRange
                    };
                    
                    lastResult.value = result;
                    calculations.value.unshift(result);
                    localStorage.setItem('apartmentCalculations', JSON.stringify(calculations.value));
                    
                    isCalculating.value = false;
                };

                const calculateApartmentPrice = (data) => {
                    let basePricePerSqm = 220000;
                    
                    if (data.buildingType) {
                        const multipliers = [0.82, 1.08, 1.18, 1.25, 1.35];
                        basePricePerSqm *= multipliers[data.buildingType - 1] || 1;
                    }
                    
                    const basePrice = basePricePerSqm * data.totalArea;
                    const finalPrice = Math.round(basePrice * (1 + (Math.random() - 0.5) * 0.1));
                    
                    return {
                        price: finalPrice,
                        priceRange: {
                            min: Math.round(finalPrice * 0.88),
                            max: Math.round(finalPrice * 1.12)
                        }
                    };
                };

                const loadCalculation = (calc) => {
                    Object.assign(formData.value, calc.apartmentData);
                    lastResult.value = calc;
                };

                const formatPrice = (price) => {
                    if (!price) return '';
                    return new Intl.NumberFormat('ru-RU', {
                        style: 'currency',
                        currency: 'RUB',
                        minimumFractionDigits: 0
                    }).format(price);
                };

                const formatDate = (date) => {
                    return new Date(date).toLocaleDateString('ru-RU');
                };

                return {
                    lastResult,
                    isCalculating,
                    calculations,
                    buildingTypes,
                    formData,
                    canCalculate,
                    calculatePrice,
                    loadCalculation,
                    formatPrice,
                    formatDate
                };
            }
        };



        // About component
        const About = {
            template: `
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h1 class="text-3xl font-bold text-gray-900 mb-6">–û –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ</h1>
                        
                        <div class="prose max-w-none">
                            <p class="text-lg text-gray-700 mb-6">
                                –ù–∞—à –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ—Ü–µ–Ω–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, 
                                –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ú–æ—Å–∫–≤—ã –∏ –æ–±–ª–∞—Å—Ç–∏.
                            </p>

                            <h2 class="text-2xl font-semibold text-gray-900 mb-4">–§–∞–∫—Ç–æ—Ä—ã –æ—Ü–µ–Ω–∫–∏</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h3 class="font-semibold text-blue-900 mb-2">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã</h3>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>‚Ä¢ –û–±—â–∞—è –∏ –∂–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å</li>
                                        <li>‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</li>
                                        <li>‚Ä¢ –≠—Ç–∞–∂ –∏ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞</li>
                                        <li>‚Ä¢ –ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏</li>
                                        <li>‚Ä¢ –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h3 class="font-semibold text-green-900 mb-2">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–æ–º–∞</h3>
                                    <ul class="text-sm text-green-800 space-y-1">
                                        <li>‚Ä¢ –¢–∏–ø –ø–æ—Å—Ç—Ä–æ–π–∫–∏</li>
                                        <li>‚Ä¢ –ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</li>
                                        <li>‚Ä¢ –ù–∞–ª–∏—á–∏–µ –ª–∏—Ñ—Ç–æ–≤</li>
                                        <li>‚Ä¢ –ú—É—Å–æ—Ä–æ–ø—Ä–æ–≤–æ–¥</li>
                                        <li>‚Ä¢ –ü–∞—Ä–∫–æ–≤–∫–∞</li>
                                    </ul>
                                </div>
                            </div>

                            <h2 class="text-2xl font-semibold text-gray-900 mb-4">–§—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="text-center p-4 border rounded-lg">
                                    <div class="text-2xl mb-2">üè†</div>
                                    <h3 class="font-semibold mb-2">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h3>
                                    <p class="text-sm text-gray-600">–¢–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</p>
                                </div>
                                
                                <div class="text-center p-4 border rounded-lg">
                                    <div class="text-2xl mb-2">üìä</div>
                                    <h3 class="font-semibold mb-2">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                                    <p class="text-sm text-gray-600">–ì—Ä–∞—Ñ–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</p>
                                </div>
                                
                                <div class="text-center p-4 border rounded-lg">
                                    <div class="text-2xl mb-2">üìÑ</div>
                                    <h3 class="font-semibold mb-2">–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤</h3>
                                    <p class="text-sm text-gray-600">PDF –∏ Excel –æ—Ç—á–µ—Ç—ã –¥–ª—è –ø–µ—á–∞—Ç–∏</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
        };

        // Routes
        const routes = [
            { path: '/', component: Calculator },
            { path: '/about', component: About }
        ];

        // Router
        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        // Create simple app with router
        const app = createApp({});
        app.use(router);
        app.mount('#app');
    </script>
</body>
</html>