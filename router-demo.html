<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã - SPA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-2">
                        <div class="text-2xl font-bold text-blue-600">üè†</div>
                        <span class="text-xl font-semibold text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä</span>
                    </div>
                    
                    <div class="hidden md:flex space-x-6">
                        <router-link to="/" class="nav-link" active-class="nav-link-active">
                            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                        </router-link>
                        <router-link to="/history" class="nav-link" active-class="nav-link-active">
                            –ò—Å—Ç–æ—Ä–∏—è
                        </router-link>
                        <router-link to="/analytics" class="nav-link" active-class="nav-link-active">
                            –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                        </router-link>
                        <router-link to="/about" class="nav-link" active-class="nav-link-active">
                            –û –ø—Ä–æ–µ–∫—Ç–µ
                        </router-link>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <router-view></router-view>
        </main>
    </div>

    <style>
        .nav-link {
            @apply px-3 py-2 text-gray-600 hover:text-blue-600 transition-colors duration-200 font-medium;
        }
        .nav-link-active {
            @apply text-blue-600 border-b-2 border-blue-600;
        }
        .container {
            max-width: 1200px;
        }
    </style>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;
        const { createRouter, createWebHashHistory } = VueRouter;

        // Calculator component
        const Calculator = {
            template: `
                <div class="space-y-8">
                    <!-- Hero Section -->
                    <div class="relative bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl overflow-hidden">
                        <div class="flex flex-col lg:flex-row items-center">
                            <div class="lg:w-1/2 p-8">
                                <h1 class="text-4xl font-bold text-gray-900 mb-4">–£–∑–Ω–∞–π—Ç–µ —Ä—ã–Ω–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã</h1>
                                <p class="text-gray-700 text-lg mb-6">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        –¢–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
                                    </div>
                                    <div class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç
                                    </div>
                                </div>
                            </div>
                            <div class="lg:w-1/2">
                                <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80" 
                                     alt="–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞" 
                                     class="w-full h-64 lg:h-80 object-cover">
                            </div>
                        </div>
                    </div>

                    <!-- Calculation Result -->
                    <div v-if="lastResult" class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-semibold mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ü–µ–Ω–∫–∏</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <p class="text-sm text-gray-600 mb-1">–†—ã–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</p>
                                <p class="text-2xl font-bold text-blue-600">{{ formatPrice(lastResult.price) }}</p>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <p class="text-sm text-gray-600 mb-1">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</p>
                                <p class="text-xl font-semibold text-green-600">{{ formatPrice(lastResult.priceRange?.min) }}</p>
                            </div>
                            <div class="text-center p-4 bg-orange-50 rounded-lg">
                                <p class="text-sm text-gray-600 mb-1">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</p>
                                <p class="text-xl font-semibold text-orange-600">{{ formatPrice(lastResult.priceRange?.max) }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Apartment Form -->
                    <apartment-form @calculation-complete="handleCalculation"></apartment-form>
                </div>
            `,
            setup() {
                const lastResult = ref(null);

                const handleCalculation = (result) => {
                    lastResult.value = result;
                };

                const formatPrice = (price) => {
                    if (!price) return '';
                    return new Intl.NumberFormat('ru-RU', {
                        style: 'currency',
                        currency: 'RUB',
                        minimumFractionDigits: 0
                    }).format(price);
                };

                return { lastResult, handleCalculation, formatPrice };
            }
        };

        // History component
        const History = {
            template: `
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h1 class="text-3xl font-bold text-gray-900 mb-6">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤</h1>
                        <calculation-history></calculation-history>
                    </div>
                </div>
            `
        };

        // Analytics component
        const Analytics = {
            template: `
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h1 class="text-3xl font-bold text-gray-900 mb-6">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞</h1>
                        
                        <!-- Market Overview Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-blue-50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-blue-600">{{ averagePrice }}</div>
                                <div class="text-sm text-gray-600">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∑–∞ –º¬≤</div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-green-600">{{ totalCalculations }}</div>
                                <div class="text-sm text-gray-600">–í—Å–µ–≥–æ —Ä–∞—Å—á–µ—Ç–æ–≤</div>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-purple-600">{{ averageArea }}</div>
                                <div class="text-sm text-gray-600">–°—Ä–µ–¥–Ω—è—è –ø–ª–æ—â–∞–¥—å</div>
                            </div>
                            <div class="bg-orange-50 rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold text-orange-600">{{ priceRange }}</div>
                                <div class="text-sm text-gray-600">–†–∞–∑–±—Ä–æ—Å —Ü–µ–Ω</div>
                            </div>
                        </div>

                        <!-- Charts Section -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" v-if="calculations.length >= 3">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="text-lg font-medium mb-4">–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω</h3>
                                <canvas id="priceChart" width="400" height="200"></canvas>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="text-lg font-medium mb-4">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –¥–æ–º–æ–≤</h3>
                                <canvas id="buildingTypeChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <!-- No data message -->
                        <div v-else class="text-center py-12 text-gray-500">
                            <p class="text-lg">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>
                            <p class="text-sm">–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const calculations = computed(() => {
                    const stored = localStorage.getItem('apartmentCalculations');
                    return stored ? JSON.parse(stored) : [];
                });

                const totalCalculations = computed(() => calculations.value.length);

                const averagePrice = computed(() => {
                    if (calculations.value.length === 0) return '0 ‚ÇΩ';
                    const total = calculations.value.reduce((sum, calc) => {
                        return sum + (calc.price / calc.apartmentData.totalArea);
                    }, 0);
                    const avg = total / calculations.value.length;
                    return new Intl.NumberFormat('ru-RU', {
                        style: 'currency',
                        currency: 'RUB',
                        minimumFractionDigits: 0
                    }).format(avg);
                });

                const averageArea = computed(() => {
                    if (calculations.value.length === 0) return '0 –º¬≤';
                    const total = calculations.value.reduce((sum, calc) => {
                        return sum + calc.apartmentData.totalArea;
                    }, 0);
                    return Math.round(total / calculations.value.length) + ' –º¬≤';
                });

                const priceRange = computed(() => {
                    if (calculations.value.length === 0) return '0%';
                    const prices = calculations.value.map(calc => calc.price);
                    const min = Math.min(...prices);
                    const max = Math.max(...prices);
                    const range = ((max - min) / min) * 100;
                    return Math.round(range) + '%';
                });

                return {
                    calculations,
                    totalCalculations,
                    averagePrice,
                    averageArea,
                    priceRange
                };
            }
        };

        // About component
        const About = {
            template: `
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h1 class="text-3xl font-bold text-gray-900 mb-6">–û –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ</h1>
                        
                        <div class="prose max-w-none">
                            <p class="text-lg text-gray-700 mb-6">
                                –ù–∞—à –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ—Ü–µ–Ω–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, 
                                –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ú–æ—Å–∫–≤—ã –∏ –æ–±–ª–∞—Å—Ç–∏.
                            </p>

                            <h2 class="text-2xl font-semibold text-gray-900 mb-4">–§–∞–∫—Ç–æ—Ä—ã –æ—Ü–µ–Ω–∫–∏</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h3 class="font-semibold text-blue-900 mb-2">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã</h3>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>‚Ä¢ –û–±—â–∞—è –∏ –∂–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å</li>
                                        <li>‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</li>
                                        <li>‚Ä¢ –≠—Ç–∞–∂ –∏ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞</li>
                                        <li>‚Ä¢ –ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏</li>
                                        <li>‚Ä¢ –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h3 class="font-semibold text-green-900 mb-2">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–æ–º–∞</h3>
                                    <ul class="text-sm text-green-800 space-y-1">
                                        <li>‚Ä¢ –¢–∏–ø –ø–æ—Å—Ç—Ä–æ–π–∫–∏</li>
                                        <li>‚Ä¢ –ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</li>
                                        <li>‚Ä¢ –ù–∞–ª–∏—á–∏–µ –ª–∏—Ñ—Ç–æ–≤</li>
                                        <li>‚Ä¢ –ú—É—Å–æ—Ä–æ–ø—Ä–æ–≤–æ–¥</li>
                                        <li>‚Ä¢ –ü–∞—Ä–∫–æ–≤–∫–∞</li>
                                    </ul>
                                </div>
                            </div>

                            <h2 class="text-2xl font-semibold text-gray-900 mb-4">–§—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="text-center p-4 border rounded-lg">
                                    <div class="text-2xl mb-2">üè†</div>
                                    <h3 class="font-semibold mb-2">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h3>
                                    <p class="text-sm text-gray-600">–¢–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</p>
                                </div>
                                
                                <div class="text-center p-4 border rounded-lg">
                                    <div class="text-2xl mb-2">üìä</div>
                                    <h3 class="font-semibold mb-2">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                                    <p class="text-sm text-gray-600">–ì—Ä–∞—Ñ–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</p>
                                </div>
                                
                                <div class="text-center p-4 border rounded-lg">
                                    <div class="text-2xl mb-2">üìÑ</div>
                                    <h3 class="font-semibold mb-2">–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤</h3>
                                    <p class="text-sm text-gray-600">PDF –∏ Excel –æ—Ç—á–µ—Ç—ã –¥–ª—è –ø–µ—á–∞—Ç–∏</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
        };

        // Routes
        const routes = [
            { path: '/', component: Calculator },
            { path: '/history', component: History },
            { path: '/analytics', component: Analytics },
            { path: '/about', component: About }
        ];

        // Router
        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        // Include apartment form and calculation history components from the original demo
        const apartmentFormScript = document.createElement('script');
        apartmentFormScript.src = '/demo.html';
        
        // App with shared state management
        const app = createApp({
            setup() {
                const calculations = ref([]);
                
                // Load calculations from localStorage
                onMounted(() => {
                    const stored = localStorage.getItem('apartmentCalculations');
                    if (stored) {
                        try {
                            calculations.value = JSON.parse(stored);
                        } catch (error) {
                            console.error('Error loading calculations:', error);
                        }
                    }
                });
                
                // Provide calculations to all components
                provide('calculations', calculations);
                
                return { calculations };
            }
        });
        
        app.use(router);
        app.mount('#app');
    </script>
</body>
</html>